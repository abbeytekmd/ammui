<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AMMUI | OpenHome Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="top-bar">
            <header>
                <div class="header-main">
                    <div class="logo-group" onclick="openAboutModal()" style="cursor: pointer;"
                        title="About Abbeytek Music Machine">
                        <img src="/amm-icon.png" alt="AMM Logo" class="header-logo">
                        <h1>AMMUI</h1>
                    </div>
                    <button id="btn-manage-devices" onclick="openManageModal()" class="btn-control ghost"
                        title="Settings for saved devices">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                        </svg>
                        Settings
                    </button>
                    <button id="btn-show-console" onclick="openConsoleModal()" class="btn-control ghost"
                        title="Show application logs">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="4 17 10 11 4 5"></polyline>
                            <line x1="12" y1="19" x2="20" y2="19"></line>
                        </svg>
                        Console
                    </button>
                </div>
            </header>

            <nav class="mobile-tabs">
                <button onclick="switchView('browser')" id="tab-browser" class="tab-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Sources
                    <span id="tab-server-count" class="tab-badge">0</span>
                </button>
                <button onclick="switchView('playlist')" id="tab-playlist" class="tab-item active">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linejoin="round">
                        <path d="M6 9h5l7-7v20l-7-7H6V9z" fill="currentColor"></path>
                    </svg>
                    Players
                    <span id="tab-renderer-count" class="tab-badge">0</span>
                </button>
            </nav>
        </div>

        <main class="main-layout">
            <!-- Left Column: Media Library & Folders -->
            <div class="column browser-column">
                <section class="device-section">
                    <div class="section-header">
                        <h2>Media Library</h2>
                        <span id="server-count" class="badge">0 active</span>
                    </div>
                    <div id="server-list" class="device-list">
                        <div class="empty-state">Searching for Media Libraries...</div>
                    </div>
                </section>

                <div id="browser-container" class="playlist-container">
                    <div class="section-header">
                        <div class="header-group">
                            <div class="header-controls">
                                <div class="browser-control-group">
                                    <button id="btn-play-all" onclick="playAll()" class="btn-control disabled primary"
                                        title="Clear and play all tracks">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M5 3l14 9-14 9V3z"></path>
                                        </svg>
                                        Play All
                                    </button>
                                    <span class="divider"></span>
                                    <button id="btn-add-all" onclick="addAllToPlaylist()" class="btn-control disabled"
                                        title="Queue all tracks on view">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M12 5v14M5 12h14"></path>
                                        </svg>
                                        Queue All
                                    </button>
                                    <span class="divider"></span>
                                    <button id="btn-set-home" onclick="setHome()" class="btn-control"
                                        title="Set current folder as home">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                        </svg>
                                        Set Home
                                    </button>
                                    <span class="divider local-only" style="display: none;"></span>
                                    <button id="btn-upload" onclick="triggerUpload()" class="btn-control local-only"
                                        style="display: none;" title="Upload to local server">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17 8 12 3 7 8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                        Upload
                                    </button>
                                    <input type="file" id="upload-input" style="display: none;" accept="audio/*"
                                        onchange="handleFileUpload(event)">
                                </div>
                            </div>
                            <div id="browser-breadcrumbs" class="breadcrumbs">
                                <!-- Breadcrumbs will go here -->
                            </div>
                        </div>
                    </div>
                    <div class="browser-content-wrapper">
                        <div id="browser-items" class="playlist-items">
                            <div class="empty-state">Select a server to browse folders</div>
                        </div>
                        <div id="alphabet-scroll" class="alphabet-scroll"></div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Players & Playlist -->
            <div class="column player-column active">
                <section class="device-section">
                    <div class="section-header">
                        <h2>Players</h2>
                        <span id="renderer-count" class="badge">0 active</span>
                    </div>
                    <div id="device-list" class="device-list">
                        <div class="empty-state">Searching for Players...</div>
                    </div>
                </section>

                <div id="playlist-container" class="playlist-container">
                    <div class="section-header">
                        <div class="header-group">
                            <div class="playlist-controls">
                                <div class="volume-control-wrapper">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                    </svg>
                                    <div class="volume-slider-container">
                                        <button class="btn-volume-step" onclick="adjustVolume(-5)"
                                            title="Decrease volume">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2.5">
                                                <path d="M5 12h14"></path>
                                            </svg>
                                        </button>
                                        <input type="range" id="volume-slider" min="0" max="100" step="1"
                                            oninput="updateVolume(this.value)" class="volume-slider">
                                        <button class="btn-volume-step" onclick="adjustVolume(5)"
                                            title="Increase volume">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2.5">
                                                <path d="M12 5v14M5 12h14"></path>
                                            </svg>
                                        </button>
                                        <div id="volume-value">0%</div>
                                    </div>
                                </div>
                                <button id="id-sonos-eq" onclick="openSonosEqModal()" class="btn-control"
                                    style="display: none;" title="Equalizer Settings">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5">
                                        <line x1="4" y1="21" x2="4" y2="14" />
                                        <line x1="4" y1="10" x2="4" y2="3" />
                                        <line x1="12" y1="21" x2="12" y2="12" />
                                        <line x1="12" y1="8" x2="12" y2="3" />
                                        <line x1="20" y1="21" x2="20" y2="16" />
                                        <line x1="20" y1="12" x2="20" y2="3" />
                                        <line x1="1" y1="14" x2="7" y2="14" />
                                        <line x1="9" y1="8" x2="15" y2="8" />
                                        <line x1="17" y1="16" x2="23" y2="16" />
                                    </svg>
                                </button>
                                <span class="divider"></span>
                                <div class="header-status-group">
                                    <span id="playlist-count" class="badge">0</span>
                                    <button id="btn-clear" onclick="clearPlaylist()" class="btn-control"
                                        title="Clear Playlist">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path
                                                d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6">
                                            </path>
                                        </svg>
                                        Clear
                                    </button>
                                </div>
                            </div>
                            <div class="position-control-wrapper">
                                <div id="now-playing-label" class="now-playing-label">Not Playing</div>
                                <span id="pos-current" class="time-label">0:00</span>
                                <div class="position-slider-container">
                                    <input type="range" id="position-slider" min="0" max="100" value="0" step="1"
                                        oninput="updatePositionDisplay(this.value)" onchange="seekTo(this.value)"
                                        class="position-slider">
                                </div>
                                <span id="pos-duration" class="time-label">0:00</span>
                            </div>
                        </div>
                    </div>
                    <div id="playlist-items" class="playlist-items">
                        <div class="empty-state">Select a renderer to view playlist</div>
                    </div>
                </div>
            </div>
        </main>


    </div>

    <div id="server-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-group">
                    <h2>Select Media Library</h2>
                </div>
                <button class="btn-close" onclick="closeServerModal()">✕</button>
            </div>
            <div id="modal-server-list" class="device-list">
                <!-- Servers will be listed here -->
            </div>
        </div>
    </div>

    <div id="renderer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-group">
                    <h2>Select Player</h2>
                </div>
                <button class="btn-close" onclick="closeRendererModal()">✕</button>
            </div>
            <div id="modal-renderer-list" class="device-list">
                <!-- Renderers will be listed here -->
            </div>
        </div>
    </div>

    <div id="manage-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content manage-modal-content">
            <div class="modal-header">
                <div class="modal-title-group">
                    <h2>Settings</h2>
                </div>
                <button class="btn-close" onclick="closeManageModal()">✕</button>
            </div>
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchSettingsTab('general')">General</button>
                <button class="settings-tab" onclick="switchSettingsTab('players')">Players</button>
                <button class="settings-tab" onclick="switchSettingsTab('servers')">Servers</button>
                <button class="settings-tab" onclick="switchSettingsTab('integrations')">Integrations</button>
            </div>
            <div class="manage-list-container">
                <div id="settings-general" class="settings-panel active">
                    <div class="manage-section">
                        <h3>General Settings</h3>
                        <div class="settings-group">
                            <label for="device-name-input">Device Name</label>
                            <input type="text" id="device-name-input" placeholder="e.g. Living Room"
                                onchange="saveGeneralSettings()">
                            <p class="settings-hint">This name will appear in the UI and as the DLNA server name.
                            </p>
                        </div>
                    </div>
                </div>
                <div id="settings-players" class="settings-panel">
                    <div class="manage-section">
                        <div class="settings-header-row">
                            <h3>Players</h3>
                            <button class="btn-control btn-seek" onclick="triggerDiscovery(this)"
                                title="Search for more players">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                Seek
                            </button>
                        </div>
                        <div id="manage-renderer-list" class="manage-device-list"></div>
                    </div>
                </div>
                <div id="settings-servers" class="settings-panel">
                    <div class="manage-section">
                        <div class="settings-header-row">
                            <h3>Media Servers</h3>
                            <button class="btn-control btn-seek" onclick="triggerDiscovery(this)"
                                title="Search for more servers">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                Seek
                            </button>
                        </div>
                        <div id="manage-server-list" class="manage-device-list"></div>
                    </div>
                </div>
                <div id="settings-integrations" class="settings-panel">
                    <div class="manage-section">
                        <h3>Integrations</h3>
                        <div class="settings-group">
                            <label for="discogs-token-input">Discogs API Token</label>
                            <div class="input-with-button">
                                <input type="password" id="discogs-token-input"
                                    placeholder="Enter your Discogs Personal Access Token"
                                    onchange="saveDiscogsToken()">
                            </div>
                            <p class="settings-hint">Used for high-quality album artwork search. <a
                                    href="https://www.discogs.com/settings/developers" target="_blank"
                                    rel="noopener">Get
                                    yours here</a>.</p>
                        </div>

                        <div class="settings-group" style="margin-top: 2rem;">
                            <div class="settings-header-row">
                                <label>S3 Cloud Sync</label>
                                <label class="switch">
                                    <input type="checkbox" id="s3-enabled" onchange="saveS3Settings()">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="s3-settings-grid">
                                <div class="input-group">
                                    <label for="s3-endpoint">Endpoint</label>
                                    <input type="text" id="s3-endpoint" placeholder="e.g. s3.amazonaws.com"
                                        onchange="saveS3Settings()">
                                </div>
                                <div class="input-group">
                                    <label for="s3-region">Region</label>
                                    <input type="text" id="s3-region" placeholder="e.g. us-east-1"
                                        onchange="saveS3Settings()">
                                </div>
                                <div class="input-group">
                                    <label for="s3-bucket">Bucket</label>
                                    <input type="text" id="s3-bucket" placeholder="Bucket name"
                                        onchange="saveS3Settings()">
                                </div>
                                <div class="input-group">
                                    <label for="s3-access-key">Access Key</label>
                                    <input type="text" id="s3-access-key" placeholder="Access Key ID"
                                        onchange="saveS3Settings()">
                                </div>
                                <div class="input-group" style="grid-column: span 2;">
                                    <label for="s3-secret-key">Secret Key</label>
                                    <input type="password" id="s3-secret-key" placeholder="Secret Access Key"
                                        onchange="saveS3Settings()">
                                </div>
                            </div>

                            <div id="s3-sync-status-container" class="sync-status-container"
                                style="display: none; margin-top: 1rem;">
                                <div class="sync-status-row">
                                    <span class="sync-status-label">Status:</span>
                                    <span id="s3-sync-state" class="sync-status-value">Idle</span>
                                </div>
                                <div id="s3-sync-progress-row" class="sync-progress-row" style="display: none;">
                                    <div class="progress-info">
                                        <span id="s3-sync-count">0/0 files</span>
                                        <span id="s3-sync-percent">0%</span>
                                    </div>
                                    <div class="progress-bar-bg">
                                        <div id="s3-sync-bar" class="progress-bar-fill" style="width: 0%;"></div>
                                    </div>
                                    <div id="s3-sync-file" class="sync-current-file"></div>
                                </div>
                                <div class="sync-actions" style="margin-top: 0.5rem;">
                                    <button id="btn-s3-sync-now" onclick="triggerS3Sync()"
                                        class="btn-control btn-small primary">Sync Now</button>
                                    <span id="s3-last-sync" class="last-sync-time"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sonos-eq-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content eq-modal-content">
            <div class="modal-header">
                <h2>Sonos Equalizer</h2>
                <button class="btn-close" onclick="closeSonosEqModal()">✕</button>
            </div>
            <div class="eq-controls">
                <div class="eq-group">
                    <div class="eq-label-row">
                        <label>Bass</label>
                        <span id="bass-value">0</span>
                    </div>
                    <input type="range" id="bass-slider" min="-10" max="10" step="1"
                        oninput="updateEqValue('bass', this.value)" onchange="applyEq('bass', this.value)">
                </div>
                <div class="eq-group">
                    <div class="eq-label-row">
                        <label>Treble</label>
                        <span id="treble-value">0</span>
                    </div>
                    <input type="range" id="treble-slider" min="-10" max="10" step="1"
                        oninput="updateEqValue('treble', this.value)" onchange="applyEq('treble', this.value)">
                </div>
            </div>
        </div>
    </div>

    <!-- Track Info Modal -->
    <div id="track-info-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content info-modal-content">
            <div class="modal-header">
                <h2>Track Information</h2>
                <button class="btn-close" onclick="closeTrackInfoModal()">✕</button>
            </div>
            <div id="track-metadata-list" class="metadata-list">
                <!-- Metadata items will be injected here -->
            </div>
        </div>
    </div>

    <!-- Album Art Fullscreen Modal -->
    <div id="album-art-modal" class="modal-overlay" style="display: none; cursor: pointer; z-index: 3000;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 1.5rem; max-width: 90vw;">
            <img id="modal-art-img"
                style="max-width: 90vw; max-height: 70vh; border-radius: 1rem; box-shadow: 0 0 50px rgba(0,0,0,0.5); object-fit: contain;">
            <div id="modal-track-info"
                style="text-align: center; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.8); max-width: 600px;">
                <div id="modal-track-title" style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem;"></div>
                <div id="modal-track-artist" style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 0.25rem;"></div>
                <div id="modal-track-album" style="font-size: 1rem; opacity: 0.7;"></div>
            </div>
        </div>
    </div>

    <!-- Console Log Modal -->
    <div id="console-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content console-modal-content">
            <div class="modal-header">
                <div class="header-group">
                    <h2>Application Console</h2>
                    <button onclick="clearLogs()" class="btn-control ghost btn-small">Clear Logs</button>
                </div>
                <button class="btn-close" onclick="closeConsoleModal()">✕</button>
            </div>
            <div id="ssdp-registry-container" class="ssdp-registry-container">
                <!-- SSDP Table will be injected here -->
            </div>
            <div id="console-log-list" class="console-log-list">
                <!-- Logs will be appended here -->
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
    <div id="about-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content about-modal-content">
            <div class="modal-header">
                <h2>About</h2>
                <button class="btn-close" onclick="closeAboutModal()">✕</button>
            </div>
            <div class="about-content">
                <img src="/amm-icon.png" alt="AMM Logo" class="about-logo">
                <h1 id="about-app-name">Abbeytek Music Machine</h1>
                <p class="about-version">Version v0.1</p>
                <div class="about-details">
                    <p>A premium OpenHome and DLNA media explorer and controller.</p>
                    <p class="copyright">© 2026 Abbeytek Ltd.</p>
                </div>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
</body>

</html>